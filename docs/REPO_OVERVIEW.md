# Repository Structure and Detailed Overview

This document provides a detailed summary of each folder and file in the **valorantâ€‘sim** repository. It is intended to help new contributors understand the codebase and locate functionality quickly.

---

## ğŸ“ /. (Root)

- **.git/**
  - Git internal metadata. Not intended for direct editing.

- **.gitignore**
  - Lists files and directories to be excluded from version control (e.g., `__pycache__/`, log files, build artifacts).

- **.env**
  - Environment variables for local development (e.g., database URLs, API keys). Ensure secrets are **not** checked in.

- **README.md**
  - Highâ€‘level project introduction, installation guides, and basic usage examples.

- **API_CONSOLIDATION.md**
  - Describes all FastAPI endpoints, request/response schemas, and integration details.

- **requirements.txt**
  - Pinâ€‘file for pip installs. Lists Python dependencies and versions.

- **pyproject.toml** & **poetry.lock**
  - Poetry metadata and lockfile for Python dependency management. Choose one approach (pip or Poetry) to avoid duplication.

- **package-lock.json**
  - npm lockfile for the frontend. If using yarn or pnpm, remove this to avoid confusion.

- **valorant_sim.db**
  - SQLite database containing sample data. Should be removed from Git and replaced with migrations or seed scripts.

- **start.sh**
  - Shell script to launch local services (API server, database, monitoring).

- **run_game.py**
  - CLI entrypoint for simulating a single match via Python, useful for quick testing.

- **demo_match.py**
  - Lightweight script showing how to call the simulation engine, often used in tutorials or demos.

- **test_db_match.py**
  - A standalone pytest script; should be moved under `tests/`.

- **.pytest_cache/** & **.coverage**
  - Generated by pytest; should be added to `.gitignore` and not tracked.

---

## ğŸ“ /docs

Documentation and design artifacts:

- **simulation_engine.md** (155Â lines)
  - Inâ€‘depth explanation of the match simulation engine: classes, methods (`_simulate_round`, economy flow), dataclasses, events.

- **TECHNICAL_DESIGN.md** (210Â lines)
  - Architecture overview: component diagrams, sequence flows, data models, and technology choices.

- **research.md** (210Â lines)
  - Notes, benchmarks, and external references consulted during development (algorithmic analysis, design tradeâ€‘offs).

- **REPO_OVERVIEW.md** _(this file)_
  - Summary of the entire codebase structure.

---

## ğŸ“ /app

Main application code (Python backend and simulation engine).

### ğŸ“„ main.py (370Â lines)
- FastAPI app initialization, router registration, middleware, error handlers.

### ğŸ“„ game.py (187Â lines)
- Synchronous CLI script to launch match simulations without HTTP.

### ğŸ“ simulation
Contains the core Valorant simulation engine.

- **match_engine.py**
  - Implements `MatchEngine` with methods:
    - `_simulate_round`: purchase logic, duels, economy updates, strategy decisions, round result.
    - `_buy_phase`: weapon/armor purchasing rules, testâ€hooks for deterministic buys.
    - Helper methods (`_determine_round_strategy`, duel simulations, map events).
  - Data classes (`SimMatch`, `RoundState`, `MapEvent`, `PlayerPosition`) used across the engine.

- **maps.py**
  - Definitions of `MapLayout`, `MapArea`, and collection of map geometries used for simulated positions.

- **weapons.py**
  - `WeaponFactory`, weapon catalog, cost definitions, penetration & range multipliers.

### ğŸ“ api/v1
Versioned REST API endpoints for external clients.

- **match.py**
  - `/simulate`: Simulate entire matches, persists to DB, returns results & economy logs.
  - `/simulate-round`: Calls `MatchEngine._simulate_round`, returns round summary and team info.
  - `/economy/{match_id}` & `/recent`: Query endpoints for retrieving economy logs and recent matches.

### ğŸ“ repositories
Database access layer (SQLAlchemy ORM wrappers).

- **match_repository.py**
  - CRUD operations for match records & economy logs.

- **team_repository.py**
  - Fetch teams and their players by ID or name.

### ğŸ“ db

- **session.py**
  - `get_db()` dependency for FastAPI; binds a SQLAlchemy `Session` to each request.

### ğŸ“ models

- SQLAlchemy model classes: `Team`, `Player`, `Match`, `EconomyLog`, etc.

### ğŸ“ core

- Shared utilities, constants, and domainâ€‘specific helpers outside simulation logic.

### ğŸ“ scripts

- Misc. maintenance scripts. Consolidate monitoring, migration, or dataâ€load helpers here.

---

## ğŸ“ /app/frontend

React + TypeScript client.

### ğŸ“ public
- Static assets (HTML template, favicon).

### ğŸ“ src

#### ğŸ“ components
- **RoundPlayByPlay.tsx**: Timeline UI, fetches `/simulate-round`, visualizes events.
- **LiveMatchSimulation.tsx**: Simulates entire matches roundâ€‘byâ€‘round.
- Other reusable UI pieces (buttons, icons, chips).

#### ğŸ“ pages
- **RoundPlayByPlayDemo.tsx**: Demo page for standalone playâ€‘byâ€‘play component.
- Additional pages for match overviews or team selection.

#### ğŸ“ services
- **ApiService.ts**: Wrapper around `fetch`/`axios`, exports `simulate` and `simulateRound` calls.

#### ğŸ“ types
- **api.types.ts**: Pydanticâ€‘style TS interfaces to describe request/response shapes.

#### ğŸ“ utils
- **metrics.ts**: Analytics event logging.
- **formatters.ts**: Time formatting and helper functions.

#### ğŸ“„ config.ts
- Contains `API_URL` and environment flags.

#### Other configs
- `package.json`, `tsconfig.json`, ESLint/Prettier settings, CI config.

---

## ğŸ“ /data & /prometheus

Infrastructure scripts and configs for metrics and monitoring.

- **docker-compose.monitoring.yml**: Defines Prometheus, Grafana, and exporters.
- Shell scripts to launch Prometheus locally or open the Grafana dashboard.

---

## ğŸ“ /tests

Pytest test suites.

- Organize tests into subdirectories by feature (`tests/simulation/`, `tests/api/`).
- Include tests for `MatchEngine._buy_phase`, economy updates, and API endpoints.

---

*This overview should serve as a guide for developers contributing to the project. Keep it updated as the codebase evolves.* 